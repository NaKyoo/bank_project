name: CI Bank Project

# ------------------------------------------------------------------
# DÉFINITION DU WORKFLOW (SCÉNARIO)
# ------------------------------------------------------------------
# Ce fichier traduit votre story :
# "JE VEUX que lors d’un push sur GITHUB, que mon application soit directement build"
# "AFIN DE pouvoir être notifié si une modification d’un développeur à eu un impact négatif"

# 1. DÉCLENCHEUR (TRIGGER)
# On définit quand l'action doit se lancer. Ici, à chaque "push" sur n'importe quelle branche.
on: [push]

jobs:
  build-and-verify:
    # 2. ENVIRONNEMENT
    # L'environnement sur lequel tourne l'action (une machine virtuelle Ubuntu prête à l'emploi).
    runs-on: ubuntu-latest

    steps:
      # 3. ÉTAPES (STEPS)
      
      # Étape A : Récupérer le code source du dépôt (Git Checkout)
      - name: Checkout code
        uses: actions/checkout@v4

      # Étape B : Installer et configurer Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13.7" # On s'assure d'utiliser une version stable de Python

      # Étape C : Installer les dépendances du projet
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          # On installe aussi un "Linter" (flake8) pour analyser le code.
          # C'est souvent ce qu'on appelle le "build" en Python (vérifier que ça s'installe et que c'est propre).
          pip install flake8

      # Étape D : Analyser le code (Build / Lint)
      # Si cette étape échoue (ex: erreur de syntaxe), le workflow s'arrête et GitHub vous envoie une notification.
      # Cela répond à votre critère : "notifié si une modification a un impact négatif".
      - name: Lint with flake8
        run: |
          # Vérifie les erreurs de syntaxe (E9, F63, etc.) et arrête le build si trouvé.
          flake8 src --count --select=E9,F63,F7,F82 --show-source --statistics
          # Vérifie le style (optionnel) mais ne bloque pas le build (--exit-zero).
          flake8 src --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

      # Étape E : Lancer les tests (Optionnel pour l'instant)
      # Si vous ajoutez des tests avec pytest plus tard, décommenter les lignes ci-dessous.
      # - name: Test with pytest
      #   run: |
      #     pip install pytest
      #     pytest
